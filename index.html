<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<title>FitTrack Pro</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
--primary: #4361ee;
--success: #06d6a0;
--danger: #ef4444;
--light: #f8f9fa;
--dark: #212529;
--bg: #f0f4f8;
--card: #ffffff;
}
[data-theme="dark"] {
--bg: #0f172a;
--card: #1e293b;
--light: #0f172a;
--dark: #f1f5f9;
}
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
body {
background-color: var(--bg);
color: var(--dark);
direction: rtl;
transition: background: bg 0.3s, color 0.3s;
}
body.en { direction: ltr; text-align: left; }

/* ========== Theme Toggle ========== */
.theme-toggle {
  background: var(--card);
  border: 1px solid #cbd5e1;
  border-radius: 50%;
  width: 38px;
  height: 38px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
[data-theme="dark"] .theme-toggle {
  border-color: #475569;
}
.theme-toggle i {
  font-size: 1rem;
  color: var(--dark);
}
[data-theme="dark"] .theme-toggle i {
  color: #f1f5f9;
}

/* ========== BEFORE LOGIN ========== */
#preAuthSection {
max-width: 400px;
margin: 60px auto;
padding: 30px;
background: var(--card);
border-radius: 20px;
box-shadow: 0 8px 24px rgba(0,0,0,0.1);
text-align: center;
position: relative;
}
.app-logo {
font-size: 3.5rem;
color: var(--primary);
margin-bottom: 20px;
}
.app-title {
font-size: 1.8rem;
font-weight: 800;
color: var(--primary);
margin-bottom: 25px;
}
.input-group {
margin-bottom: 20px;
text-align: right;
}
.input-group.en { text-align: left; }
.input-group input {
width: 100%;
padding: 14px;
border: 1px solid #4b5563;
border-radius: 12px;
font-size: 1rem;
background: var(--card);
color: var(--dark);
}
.auth-buttons {
display: flex;
gap: 12px;
margin-top: 10px;
}
.auth-btn {
flex: 1;
padding: 12px;
border: none;
border-radius: 12px;
font-weight: bold;
cursor: pointer;
font-size: 1rem;
}
.signup-btn { background: var(--primary); color: white; }
.login-btn { background: #6c757d; color: white; }
.auth-btn:hover { opacity: 0.9; }

/* ========== AFTER LOGIN ========== */
.top-nav {
position: fixed;
top: 0;
left: 0;
right: 0;
background: var(--card);
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
padding: 0 15px;
height: 60px;
display: flex;
align-items: center;
justify-content: space-between;
z-index: 1000;
}
.nav-icons {
display: flex;
gap: 28px;
}
.nav-icon {
font-size: 1.4rem;
color: #94a3b8;
cursor: pointer;
transition: color 0.2s;
}
.nav-icon.active, .nav-icon:hover {
color: var(--primary);
}
.logo-icon {
font-size: 1.8rem;
color: var(--primary);
}
#appSection {
padding-top: 70px;
padding-bottom: 20px;
}
.container { max-width: 100%; padding: 0 15px; }
.section {
background: var(--card);
padding: 22px;
border-radius: 18px;
margin-bottom: 22px;
box-shadow: 0 4px 12px rgba(0,0,0,0.06);
}
.hidden { display: none; }
label { display: block; margin: 14px 0 8px; font-weight: 600; }
input, select, button {
width: 100%;
padding: 13px;
margin-bottom: 18px;
border: 1px solid #4b5563;
border-radius: 12px;
font-size: 1rem;
background: var(--card);
color: var(--dark);
}
button {
background: var(--primary);
color: white;
font-weight: bold;
border: none;
cursor: pointer;
}
.stats-grid {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 16px;
margin: 20px 0;
}
.stat-card {
background: #f8fafc;
padding: 16px;
border-radius: 14px;
text-align: center;
}
[data-theme="dark"] .stat-card { background: #334155; }
.stat-value { font-size: 1.4rem; font-weight: bold; color: var(--primary); }
.stat-label { font-size: 0.85rem; color: #64748b; margin-top: 4px; }
[data-theme="dark"] .stat-label { color: #cbd5e1; }
canvas { max-height: 250px; margin-top: 20px; }
.gps-status {
text-align: center;
padding: 10px;
background: #e2e8f0;
border-radius: 10px;
margin: 15px 0;
font-size: 0.9rem;
}
[data-theme="dark"] .gps-status { background: #334155; color: #f1f5f9; }
.logout-btn {
background: var(--danger);
width: auto;
padding: 10px 20px;
margin-top: 10px;
}
.progress-bar {
height: 10px;
background: #e2e8f0;
border-radius: 5px;
margin: 10px 0;
overflow: hidden;
}
[data-theme="dark"] .progress-bar { background: #334155; }
.progress-fill {
height: 100%;
background: var(--primary);
border-radius: 5px;
transition: width 0.5s;
}
.calendar-grid {
display: grid;
grid-template-columns: repeat(7, 1fr);
gap: 4px;
margin: 15px 0;
}
.calendar-day {
width: 36px;
height: 36px;
display: flex;
align-items: center;
justify-content: center;
font-size: 0.8rem;
border-radius: 50%;
}
.calendar-day.active { background: var(--primary); color: white; }
.calendar-day.inactive { background: #e2e8f0; }
[data-theme="dark"] .calendar-day.inactive { background: #334155; color: #cbd5e1; }
.export-btn {
background: #06d6a0;
margin-top: 15px;
display: flex;
align-items: center;
justify-content: center;
gap: 8px;
}

/* Settings Theme Section */
.theme-section {
  background: var(--card);
  padding: 16px;
  border-radius: 14px;
  margin: 15px 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}
.theme-section h3 {
  margin: 0;
  font-size: 1.1rem;
}
@media (max-width: 600px) {
.auth-buttons { flex-direction: column; }
.nav-icons { gap: 20px; }
.nav-icon { font-size: 1.25rem; }
.stats-grid { grid-template-columns: 1fr; }
.theme-toggle {
  width: 34px;
  height: 34px;
}
}
</style>
</head>
<body>
<!-- ========== BEFORE LOGIN ========== -->
<div id="preAuthSection">
  <div style="position: absolute; top: 15px; left: 15px;">
    <div class="theme-toggle" onclick="toggleTheme()">
      <i class="fas fa-moon"></i>
    </div>
  </div>
  <div class="app-logo">
    <i class="fas fa-dumbbell"></i>
  </div>
  <h1 class="app-title">FitTrack Pro</h1>
  <div class="input-group" id="inputGroup">
    <input type="text" id="usernameInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" />
    <input type="password" id="passwordInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
  </div>
  <div class="auth-buttons">
    <button class="auth-btn signup-btn" onclick="handleAuth(true)">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
    <button class="auth-btn login-btn" onclick="handleAuth(false)">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
  </div>
</div>

<!-- ========== AFTER LOGIN ========== -->
<nav id="topNav" class="top-nav hidden">
  <div class="nav-icons">
    <i class="nav-icon fas fa-home active" data-tab="dashboard"></i>
    <i class="nav-icon fas fa-running" data-tab="workouts"></i>
    <i class="nav-icon fas fa-utensils" data-tab="nutrition"></i>
    <i class="nav-icon fas fa-cog" data-tab="profile"></i>
  </div>
  <div class="logo-icon">
    <i class="fas fa-dumbbell"></i>
  </div>
  <div class="theme-toggle" onclick="toggleTheme()">
    <i class="fas fa-moon"></i>
  </div>
</nav>

<div id="appSection" class="hidden">
  <!-- Dashboard Tab -->
  <div id="dashboardTab" class="tab-content">
    <div class="section">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h2 id="dashboardTitle">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠØ©</h2>
      </div>

      <!-- Ø£Ù‡Ø¯Ø§Ù ÙŠÙˆÙ…ÙŠØ© -->
      <div style="margin: 20px 0;">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
          <i class="fas fa-fire" style="color: #ef4444;"></i>
          <span id="calorieGoalLabel">Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù…Ù† Ø§Ù„Ø³Ø¹Ø±Ø§Øª</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.95rem;">
          <span id="calorieProgressText">0/2000</span>
          <span id="calorieProgressPercent">0%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="calorieProgressBar" style="width: 0%;"></div>
        </div>
      </div>

      <div style="margin: 25px 0;">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
          <i class="fas fa-shoe-prints" style="color: #4361ee;"></i>
          <span id="stepGoalLabel">Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù…Ù† Ø§Ù„Ø®Ø·ÙˆØ§Øª</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.95rem;">
          <span id="stepProgressText">0/10000</span>
          <span id="stepProgressPercent">0%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="stepProgressBar" style="width: 0%;"></div>
        </div>
      </div>

      <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø±Ø¦ÙŠØ³ÙŠØ© -->
      <div class="stats-grid">
        <div class="stat-card">
          <i class="fas fa-burn" style="font-size: 1.4rem; color: #ef4444; margin-bottom: 8px;"></i>
          <div class="stat-value" id="caloriesBurned">0</div>
          <div class="stat-label" id="caloriesBurnedLabel">Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ù…Ø­Ø±ÙˆÙ‚Ø©</div>
        </div>
        <div class="stat-card">
          <i class="fas fa-utensils" style="font-size: 1.4rem; color: #f59e0b; margin-bottom: 8px;"></i>
          <div class="stat-value" id="caloriesConsumed">0</div>
          <div class="stat-label" id="caloriesConsumedLabel">Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ù„ÙƒØ©</div>
        </div>
        <div class="stat-card">
          <i class="fas fa-balance-scale" style="font-size: 1.4rem; color: #10b981; margin-bottom: 8px;"></i>
          <div class="stat-value" id="netCalories">0</div>
          <div class="stat-label" id="netCaloriesLabel">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ØµØ§ÙÙŠ</div>
        </div>
        <div class="stat-card">
          <i class="fas fa-calendar-check" style="font-size: 1.4rem; color: #8b5cf6; margin-bottom: 8px;"></i>
          <div class="stat-value" id="daysGoalMet">0/7</div>
          <div class="stat-label" id="daysGoalMetLabel">Ø£ÙŠØ§Ù… ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù‡Ø¯Ù</div>
        </div>
      </div>

      <!-- ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù†Ø´Ø§Ø· -->
      <h3 style="margin: 25px 0 15px; display: flex; align-items: center; gap: 8px;">
        <i class="fas fa-calendar-day"></i>
        <span>ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù†Ø´Ø§Ø· (Ø¢Ø®Ø± 14 ÙŠÙˆÙ…Ù‹Ø§)</span>
      </h3>
      <div class="calendar-grid" id="activityCalendar"></div>

      <!-- Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ -->
      <h3 style="margin: 25px 0 15px; display: flex; align-items: center; gap: 8px;">
        <i class="fas fa-chart-line"></i>
        <span>Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</span>
      </h3>
      <canvas id="weeklyChart"></canvas>

      <!-- Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ± -->
      <button class="export-btn" onclick="exportData()">
        <i class="fas fa-file-csv"></i>
        <span id="exportDataLabel">ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (CSV)</span>
      </button>
    </div>
  </div>

  <!-- Workouts Tab -->
  <div id="workoutsTab" class="tab-content hidden">
    <div class="section">
      <h2 id="workoutsTitle">Ù†Ø¸Ø§Ù… Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù‡Ø¬ÙŠÙ†</h2>
      <div class="label">Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹Ø©</div>
      <div class="metric-value" id="distance" style="font-size: 28px; font-weight: bold; color: var(--primary); margin: 10px 0;">0.00 Ù…</div>
      <div class="label">Ø¹Ø¯Ø¯ Ø§Ù„Ø®Ø·ÙˆØ§Øª</div>
      <div class="metric-value" id="steps" style="font-size: 28px; font-weight: bold; color: var(--primary); margin: 10px 0;">0</div>
      <div class="label">ÙˆØ¶Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù…</div>
      <div id="mode" class="gps-status">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡</div>
      <div class="label">Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶</div>
      <div class="coord" id="lat">â€”</div>
      <div class="label">Ø®Ø· Ø§Ù„Ø·ÙˆÙ„</div>
      <div class="coord" id="lng">â€”</div>
      <div id="gpsStatus" class="gps-status">Ø§Ø¶ØºØ· "Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØªØ¨Ø¹" Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡Ø¬ÙŠÙ†</div>
      <button id="startBtn" class="btn" style="background: #10b981; color: white;">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØªØ¨Ø¹</button>
      <button id="stopBtn" class="btn" style="background: #ef4444; color: white;" disabled>Ø¥ÙŠÙ‚Ø§Ù</button>
    </div>
  </div>

  <!-- Nutrition Tab -->
  <div id="nutritionTab" class="tab-content hidden">
    <div class="section">
      <h2 id="nutritionTitle">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØºØ°ÙŠØ©</h2>
      <label id="mealLabel">Ø§Ù„ÙˆØ¬Ø¨Ø©</label>
      <select id="mealType">
        <option value="breakfast">ÙØ·ÙˆØ±</option>
        <option value="lunch">ØºØ¯Ø§Ø¡</option>
        <option value="dinner">Ø¹Ø´Ø§Ø¡</option>
        <option value="snack">ÙˆØ¬Ø¨Ø© Ø®ÙÙŠÙØ©</option>
      </select>
      <input type="text" id="foodItem" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø¹Ø§Ù…" />
      <input type="number" id="caloriesInput" placeholder="Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©" min="0" />
      <input type="number" id="proteinInput" placeholder="Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† (Øº)" min="0" step="0.1" />
      <input type="number" id="carbsInput" placeholder="Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª (Øº)" min="0" step="0.1" />
      <input type="number" id="fatsInput" placeholder="Ø§Ù„Ø¯Ù‡ÙˆÙ† (Øº)" min="0" step="0.1" />
      <button onclick="saveNutrition()">Ø­ÙØ¸ Ø§Ù„ÙˆØ¬Ø¨Ø©</button>
      <div id="nutritionList" style="margin-top: 20px;"></div>
    </div>
  </div>

  <!-- Profile Tab -->
  <div id="profileTab" class="tab-content hidden">
    <div class="section">
      <h2 id="profileTitle">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h2>
      
      <!-- Ù‚Ø³Ù… Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ -->
      <div class="theme-section">
        <h3 id="themeLabel">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†</h3>
        <div class="theme-toggle" onclick="toggleTheme()">
          <i class="fas fa-moon"></i>
        </div>
      </div>

      <!-- Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© -->
      <label id="ageLabel">Ø§Ù„Ø¹Ù…Ø±</label>
      <input type="number" id="ageInput" min="10" max="100" />
      <label id="weightLabel">Ø§Ù„ÙˆØ²Ù† (ÙƒØº)</label>
      <input type="number" id="weightInput" min="30" max="200" step="0.1" />
      <label id="heightLabel">Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)</label>
      <input type="number" id="heightInput" min="100" max="250" />
      <label id="goalLabel">Ø§Ù„Ù‡Ø¯Ù</label>
      <select id="goalInput">
        <option value="lose">Ø¥Ù†Ù‚Ø§Øµ Ø§Ù„ÙˆØ²Ù†</option>
        <option value="gain">Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¶Ù„Ø§Øª</option>
        <option value="maintain">Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ²Ù†</option>
      </select>
      <label>Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</label>
      <input type="number" id="calorieGoalInput" min="1000" max="5000" placeholder="2000" />
      <label id="stepGoalLabelProf">Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù…Ù† Ø§Ù„Ø®Ø·ÙˆØ§Øª</label>
      <input type="number" id="stepGoalInput" min="1000" max="50000" placeholder="10000" />
      <button onclick="saveProfile()">Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</button>
      <div class="user-info" id="userInfo" style="margin: 15px 0; font-weight: 600;"></div>
      <button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>
</div>

<script>
// --- Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª ---
const translations = {
ar: {
appTitle: "FitTrack Pro",
username: "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
password: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
signup: "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨",
login: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",
dashboardTitle: "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠØ©",
caloriesBurned: "Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ù…Ø­Ø±ÙˆÙ‚Ø©",
caloriesConsumed: "Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ù„ÙƒØ©",
netCalories: "Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ØµØ§ÙÙŠ",
daysGoalMet: "Ø£ÙŠØ§Ù… ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù‡Ø¯Ù",
workoutsTitle: "Ù†Ø¸Ø§Ù… Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù‡Ø¬ÙŠÙ†",
nutritionTitle: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØºØ°ÙŠØ©",
profileTitle: "Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©",
themeLabel: "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†",
walking: "Ù…Ø´ÙŠ",
running: "Ø±ÙƒØ¶",
cycling: "Ø±ÙƒÙˆØ¨ Ø¯Ø±Ø§Ø¬Ø©",
weights: "Ø±ÙØ¹ Ø£Ø«Ù‚Ø§Ù„",
time: "Ø§Ù„ÙˆÙ‚Øª",
distance: "Ø§Ù„Ù…Ø³Ø§ÙØ© (ÙƒÙ…)",
steps: "Ø§Ù„Ø®Ø·ÙˆØ§Øª",
start: "Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ…Ø±ÙŠÙ†",
stop: "Ø¥Ù†Ù‡Ø§Ø¡",
meal: "Ø§Ù„ÙˆØ¬Ø¨Ø©",
foodItem: "Ø§Ø³Ù… Ø§Ù„Ø·Ø¹Ø§Ù…",
calories: "Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©",
protein: "Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† (Øº)",
carbs: "Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª (Øº)",
fats: "Ø§Ù„Ø¯Ù‡ÙˆÙ† (Øº)",
saveMeal: "Ø­ÙØ¸ Ø§Ù„ÙˆØ¬Ø¨Ø©",
age: "Ø§Ù„Ø¹Ù…Ø±",
weight: "Ø§Ù„ÙˆØ²Ù† (ÙƒØº)",
height: "Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)",
goal: "Ø§Ù„Ù‡Ø¯Ù",
saveProfile: "Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª",
logout: "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬",
breakfast: "ÙØ·ÙˆØ±",
lunch: "ØºØ¯Ø§Ø¡",
dinner: "Ø¹Ø´Ø§Ø¡",
snack: "ÙˆØ¬Ø¨Ø© Ø®ÙÙŠÙØ©",
lose: "Ø¥Ù†Ù‚Ø§Øµ Ø§Ù„ÙˆØ²Ù†",
gain: "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¶Ù„Ø§Øª",
maintain: "Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ²Ù†",
gpsActive: "âœ… GPS Ù†Ø´Ø· â€” ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø³Ø§Ø±...",
gpsDenied: "âŒ Ù„Ù… ÙŠØªÙ… Ù…Ù†Ø­ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹",
gpsError: "âš ï¸ Ø®Ø·Ø£ ÙÙŠ GPS â€” Ø§Ù„ØªØªØ¨Ø¹ ØºÙŠØ± Ù…ØªØ§Ø­",
stepTrackingReady: "ğŸš¶â€â™‚ï¸ Ø¬Ø§Ù‡Ø² Ù„Ø¹Ø¯Ù‘ Ø§Ù„Ø®Ø·ÙˆØ§Øª...",
calorieGoalLabel: "Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù…Ù† Ø§Ù„Ø³Ø¹Ø±Ø§Øª",
stepGoalLabel: "Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù…Ù† Ø§Ù„Ø®Ø·ÙˆØ§Øª",
exportData: "ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (CSV)",
notificationOver: "âš ï¸ ØªØ¬Ø§ÙˆØ²Øª Ø³Ø¹Ø±Ø§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©!",
notificationInactive: "ğŸƒâ€â™‚ï¸ Ù„Ù… ØªØªÙ…Ø±Ù† Ø§Ù„ÙŠÙˆÙ…! Ù„Ø§ ØªÙÙˆØª ÙŠÙˆÙ…Ùƒ.",
notificationStepGoal: "ğŸ‰ Ù…Ø¨Ø§Ø±Ùƒ! Ø­Ù‚Ù‚Øª Ù‡Ø¯ÙÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù…Ù† Ø§Ù„Ø®Ø·ÙˆØ§Øª!",
darkMode: "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ",
lightMode: "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ"
},
en: {
appTitle: "FitTrack Pro",
username: "Username",
password: "Password",
signup: "Sign Up",
login: "Login",
dashboardTitle: "Analytical Dashboard",
caloriesBurned: "Calories Burned",
caloriesConsumed: "Calories Consumed",
netCalories: "Net Calories",
daysGoalMet: "Goal Days Met",
workoutsTitle: "Hybrid Tracking System",
nutritionTitle: "Log Nutrition",
profileTitle: "Personal Profile",
themeLabel: "Dark Mode",
walking: "Walking",
running: "Running",
cycling: "Cycling",
weights: "Weight Lifting",
time: "Time",
distance: "Distance (km)",
steps: "Steps",
start: "Start Workout",
stop: "Stop",
meal: "Meal",
foodItem: "Food Item",
calories: "Calories",
protein: "Protein (g)",
carbs: "Carbs (g)",
fats: "Fats (g)",
saveMeal: "Save Meal",
age: "Age",
weight: "Weight (kg)",
height: "Height (cm)",
goal: "Goal",
saveProfile: "Save Profile",
logout: "Logout",
breakfast: "Breakfast",
lunch: "Lunch",
dinner: "Dinner",
snack: "Snack",
lose: "Lose Weight",
gain: "Gain Muscle",
maintain: "Maintain Weight",
gpsActive: "âœ… GPS Active â€” Tracking...",
gpsDenied: "âŒ Location permission denied",
gpsError: "âš ï¸ GPS Error â€” Tracking unavailable",
stepTrackingReady: "ğŸš¶â€â™‚ï¸ Ready to count steps...",
calorieGoalLabel: "Daily Calorie Goal",
stepGoalLabel: "Daily Step Goal",
exportData: "Export Data (CSV)",
notificationOver: "âš ï¸ You exceeded your daily calories!",
notificationInactive: "ğŸƒâ€â™‚ï¸ You haven't worked out today! Don't miss your day.",
notificationStepGoal: "ğŸ‰ Congratulations! You've reached your daily step goal!",
darkMode: "Dark Mode",
lightMode: "Light Mode"
}
};
let currentLang = 'ar';
let currentUser = null;
let workoutActive = false;
let totalDistance = 0;
let stepCount = 0;
let lastGpsPosition = null;
let lastGpsTime = 0;
let lastAccel = 0;
let lastStepTime = 0;
let isGpsAvailable = false;
let gpsTimeout = 0;
let dailyCalorieGoal = 2000;
let dailyStepGoal = 10000;
let weeklyChart = null;
let syncInterval = null;

// --- Firebase ---
const firebaseConfig = {
apiKey: "AIzaSyC1ps0XFVjJJ1YAi2H0XEtjAc-wslWrNjo",
authDomain: "ddccdc-c6a58.firebaseapp.com",
projectId: "ddccdc-c6a58",
storageBucket: "ddccdc-c6a58.firebasestorage.app",
messagingSenderId: "339966933373",
appId: "1:339966933373:web:b638ece3460e6c7a7c7414"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// --- Theme Management ---
function getCurrentTheme() {
  const saved = localStorage.getItem('theme');
  if (saved === 'dark' || saved === 'light') return saved;
  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    return 'dark';
  }
  return 'light';
}

function applyTheme(theme) {
  document.body.setAttribute('data-theme', theme);
  const icons = document.querySelectorAll('.theme-toggle i');
  icons.forEach(icon => {
    icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
  });
  localStorage.setItem('theme', theme);
}

function toggleTheme() {
  const current = document.body.getAttribute('data-theme') || getCurrentTheme();
  const newTheme = current === 'dark' ? 'light' : 'dark';
  applyTheme(newTheme);
}

document.addEventListener('DOMContentLoaded', () => {
  const theme = getCurrentTheme();
  applyTheme(theme);
});

// --- Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ---
function showNotification(message) {
if (Notification.permission === "granted") {
new Notification(message);
} else if (Notification.permission !== "denied") {
Notification.requestPermission().then(permission => {
if (permission === "granted") {
new Notification(message);
}
});
}
}

// --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù„ØºØ© ---
function updateUI() {
const t = translations[currentLang];
document.querySelector('.app-title').innerText = t.appTitle;
document.getElementById('usernameInput').placeholder = t.username;
document.getElementById('passwordInput').placeholder = t.password;
document.querySelector('.signup-btn').innerText = t.signup;
document.querySelector('.login-btn').innerText = t.login;
document.getElementById('inputGroup').className = `input-group${currentLang === 'en' ? ' en' : ''}`;
document.getElementById('dashboardTitle').innerText = t.dashboardTitle;
document.getElementById('caloriesBurnedLabel').innerText = t.caloriesBurned;
document.getElementById('caloriesConsumedLabel').innerText = t.caloriesConsumed;
document.getElementById('netCaloriesLabel').innerText = t.netCalories;
document.getElementById('daysGoalMetLabel').innerText = t.daysGoalMet;
document.getElementById('calorieGoalLabel').innerText = t.calorieGoalLabel;
document.getElementById('stepGoalLabel').innerText = t.stepGoalLabel;
document.getElementById('exportDataLabel').innerText = t.exportData;
document.getElementById('themeLabel').innerText = t.themeLabel;
document.getElementById('workoutsTitle').innerText = t.workoutsTitle;
document.getElementById('nutritionTitle').innerText = t.nutritionTitle;
document.getElementById('mealLabel').innerText = t.meal;
document.getElementById('foodItem').placeholder = t.foodItem;
document.getElementById('caloriesInput').placeholder = t.calories;
document.getElementById('proteinInput').placeholder = t.protein;
document.getElementById('carbsInput').placeholder = t.carbs;
document.getElementById('fatsInput').placeholder = t.fats;
document.querySelector('button[onclick="saveNutrition()"]').innerText = t.saveMeal;
const mealSel = document.getElementById('mealType');
if (mealSel) {
mealSel.options[0].text = t.breakfast;
mealSel.options[1].text = t.lunch;
mealSel.options[2].text = t.dinner;
mealSel.options[3].text = t.snack;
}
document.getElementById('profileTitle').innerText = t.profileTitle;
document.getElementById('ageLabel').innerText = t.age;
document.getElementById('weightLabel').innerText = t.weight;
document.getElementById('heightLabel').innerText = t.height;
document.getElementById('goalLabel').innerText = t.goal;
document.getElementById('stepGoalLabelProf').innerText = t.stepGoalLabel;
document.querySelector('button[onclick="saveProfile()"]').innerText = t.saveProfile;
const goalSel = document.getElementById('goalInput');
if (goalSel) {
goalSel.options[0].text = t.lose;
goalSel.options[1].text = t.gain;
goalSel.options[2].text = t.maintain;
}
}

// --- Ø§Ù„ØªÙ†Ù‚Ù„ ---
function showTab(tabName) {
document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
document.querySelectorAll('.nav-icon').forEach(el => el.classList.remove('active'));
document.getElementById(tabName + 'Tab').classList.remove('hidden');
document.querySelector(`.nav-icon[data-tab="${tabName}"]`).classList.add('active');
if (tabName === 'dashboard' && currentUser) {
loadDashboard();
startAutoSync();
}
if (tabName === 'nutrition' && currentUser) loadNutritionList();
if (tabName === 'profile' && currentUser) loadProfile();
}
document.querySelectorAll('.nav-icon').forEach(icon => {
icon.addEventListener('click', () => {
showTab(icon.getAttribute('data-tab'));
});
});

// --- Auth ---
function handleAuth(isSignup) {
const username = document.getElementById('usernameInput').value.trim();
const password = document.getElementById('passwordInput').value;
if (!username || password.length < 6) return alert('Password too short (min 6)');
const email = `${username}@example.com`;
(isSignup ?
auth.createUserWithEmailAndPassword(email, password) :
auth.signInWithEmailAndPassword(email, password)
)
.then(async (userCredential) => {
if (isSignup) {
await userCredential.user.updateProfile({ displayName: username });
await db.collection('users').doc(userCredential.user.uid).set({
username,
createdAt: firebase.firestore.FieldValue.serverTimestamp()
});
}
currentUser = userCredential.user;
document.getElementById('preAuthSection').classList.add('hidden');
document.getElementById('topNav').classList.remove('hidden');
document.getElementById('appSection').classList.remove('hidden');
updateUI();
showTab('dashboard');
})
.catch(err => {
alert('Error: ' + err.message);
});
}
function logout() {
auth.signOut().then(() => {
currentUser = null;
document.getElementById('preAuthSection').classList.remove('hidden');
document.getElementById('topNav').classList.add('hidden');
document.getElementById('appSection').classList.add('hidden');
document.getElementById('usernameInput').value = '';
document.getElementById('passwordInput').value = '';
if (syncInterval) clearInterval(syncInterval);
});
}

// === === Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡Ø¬ÙŠÙ† Ù„Ù„ØªÙ…Ø§Ø±ÙŠÙ† === ===
const distanceEl = document.getElementById('distance');
const stepsEl = document.getElementById('steps');
const latEl = document.getElementById('lat');
const lngEl = document.getElementById('lng');
const modeEl = document.getElementById('mode');
const gpsStatusEl = document.getElementById('gpsStatus');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');

const STEP_THRESHOLD = 1.7;
const MIN_STEP_INTERVAL = 400;
const GPS_TIMEOUT_MS = 5000;
const AVG_STEP_LENGTH = 0.75;

function handleMotion(event) {
  if (!workoutActive) return;
  const acc = event.accelerationIncludingGravity;
  if (!acc) return;

  const now = Date.now();
  const accel = Math.sqrt(acc.x**2 + acc.y**2 + acc.z**2);
  const delta = Math.abs(accel - lastAccel);
  lastAccel = accel;

  if (delta > STEP_THRESHOLD && (now - lastStepTime) > MIN_STEP_INTERVAL) {
    stepCount++;
    stepsEl.textContent = stepCount;
    totalDistance += AVG_STEP_LENGTH;
    updateDistanceDisplay();
    lastStepTime = now;

    if (!isGpsAvailable || (now - lastGpsTime) > GPS_TIMEOUT_MS) {
      modeEl.textContent = 'ğŸš¶ ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§Ø®ÙÙ„ (PDR)';
      modeEl.style.color = '#ea580c';
      modeEl.style.background = '#ffedd5';
    }
  }
}

function updateGps() {
  if (!workoutActive) return;
  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const { latitude, longitude, accuracy } = pos.coords;
      const now = Date.now();
      latEl.textContent = latitude.toFixed(7);
      lngEl.textContent = longitude.toFixed(7);
      lastGpsPosition = { lat: latitude, lng: longitude };
      lastGpsTime = now;
      isGpsAvailable = true;
      gpsTimeout = 0;
      modeEl.textContent = 'ğŸ›°ï¸ ÙˆØ¶Ø¹ Ø§Ù„Ø®Ø§Ø±ÙØ¬ (GPS + PDR)';
      modeEl.style.color = '#1d4ed8';
      modeEl.style.background = '#dbeafe';
      gpsStatusEl.textContent = `Ø¯Ù‚Ø© GPS: ${accuracy.toFixed(1)} Ù…`;
    },
    (error) => {
      isGpsAvailable = false;
      gpsTimeout += 2000;
      if (gpsTimeout > GPS_TIMEOUT_MS) {
        modeEl.textContent = 'ğŸš¶ ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§Ø®ÙÙ„ (PDR ÙÙ‚Ø·)';
        modeEl.style.color = '#ea580c';
        modeEl.style.background = '#ffedd5';
      }
    },
    { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
  );
}

function updateDistanceDisplay() {
  if (totalDistance >= 1000) {
    distanceEl.textContent = (totalDistance / 1000).toFixed(3) + ' ÙƒÙ…';
  } else {
    distanceEl.textContent = totalDistance.toFixed(1) + ' Ù…';
  }
  db.collection('users').doc(currentUser.uid).get().then(doc => {
    const weight = doc.exists ? (doc.data().weight || 75) : 75;
    const calories = Math.round((totalDistance / 1000) * weight * 0.78);
    document.getElementById('caloriesBurned').innerText = calories;
  }).catch(() => {
    document.getElementById('caloriesBurned').innerText = Math.round((totalDistance / 1000) * 60);
  });
}

function startWorkout() {
  if (!navigator.geolocation) {
    gpsStatusEl.textContent = 'âŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…';
    return;
  }
  if (typeof DeviceMotionEvent.requestPermission === 'function') {
    DeviceMotionEvent.requestPermission().then(permission => {
      if (permission === 'granted') initWorkout();
      else gpsStatusEl.textContent = 'âŒ Ø±ÙÙØ¶ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø³';
    });
  } else {
    initWorkout();
  }
}

function initWorkout() {
  workoutActive = true;
  totalDistance = 0;
  stepCount = 0;
  lastGpsPosition = null;
  isGpsAvailable = false;
  gpsTimeout = 0;

  distanceEl.textContent = '0.00 Ù…';
  stepsEl.textContent = '0';
  latEl.textContent = 'â€”';
  lngEl.textContent = 'â€”';
  modeEl.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙØ¹ÙŠÙ„...';
  gpsStatusEl.textContent = 'âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ù†Ø´Ø· â€” ÙŠØ¹Ù…Ù„ ÙÙŠ Ø§Ù„Ø¯Ø§Ø®Ù„ ÙˆØ§Ù„Ø®Ø§Ø±Ø¬';

  startBtn.disabled = true;
  stopBtn.disabled = false;

  window.addEventListener('devicemotion', handleMotion);
  updateGps();
  setInterval(updateGps, 2000);
}

function stopWorkout() {
  workoutActive = false;
  window.removeEventListener('devicemotion', handleMotion);
  startBtn.disabled = false;
  stopBtn.disabled = true;

  const finalDistanceKm = totalDistance / 1000;
  db.collection('users').doc(currentUser.uid).get().then(userDoc => {
    const weight = userDoc.data()?.weight || 75;
    const calories = Math.round(finalDistanceKm * weight * 0.78);

    db.collection('users').doc(currentUser.uid).collection('workouts').add({
      type: 'walking',
      distance: parseFloat(finalDistanceKm.toFixed(3)),
      calories,
      steps: stepCount,
      date: new Date().toISOString().split('T')[0],
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
      gpsStatusEl.textContent = `â¹ï¸ ØªÙ… Ø§Ù„Ø­ÙØ¸: ${stepCount} Ø®Ø·ÙˆØ© | ${totalDistance >= 1000 ? (totalDistance/1000).toFixed(3) : totalDistance.toFixed(1)} ${totalDistance >= 1000 ? 'ÙƒÙ…' : 'Ù…'}`;
      loadDashboard();
    });
  });
}

startBtn.addEventListener('click', startWorkout);
stopBtn.addEventListener('click', stopWorkout);

// --- Ø§Ù„ØªØºØ°ÙŠØ© ---
function saveNutrition() {
  const food = document.getElementById('foodItem').value.trim();
  const calories = parseFloat(document.getElementById('caloriesInput').value) || 0;
  const protein = parseFloat(document.getElementById('proteinInput').value) || 0;
  const carbs = parseFloat(document.getElementById('carbsInput').value) || 0;
  const fats = parseFloat(document.getElementById('fatsInput').value) || 0;
  const meal = document.getElementById('mealType').value;
  if (!food) return alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø¹Ø§Ù…');
  db.collection('users').doc(currentUser.uid).collection('nutrition').add({
    food,
    calories,
    protein,
    carbs,
    fats,
    meal,
    date: new Date().toISOString().split('T')[0],
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  }).then(() => {
    loadNutritionList();
    document.getElementById('foodItem').value = '';
    document.getElementById('caloriesInput').value = '';
    document.getElementById('proteinInput').value = '';
    document.getElementById('carbsInput').value = '';
    document.getElementById('fatsInput').value = '';
  });
}
function loadNutritionList() {
  const container = document.getElementById('nutritionList');
  container.innerHTML = '<p>Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';
  const today = new Date().toISOString().split('T')[0];
  db.collection('users').doc(currentUser.uid).collection('nutrition')
  .get()
  .then(snapshot => {
    container.innerHTML = '<h4>Ø§Ù„ÙŠÙˆÙ…:</h4>';
    let hasData = false;
    snapshot.forEach(doc => {
      const n = doc.data();
      if (n.date === today) {
        hasData = true;
        container.innerHTML += `<div style="padding: 8px; border-bottom: 1px solid #eee;">
        <strong>${n.food}</strong> (${n.meal})<br>
        ${n.calories} Ø³Ø¹Ø±Ø© Ø­Ø±Ø§Ø±ÙŠØ©
        </div>`;
      }
    });
    if (!hasData) {
      container.innerHTML += '<p>Ù„Ù… ØªÙØ³Ø¬Ù‘Ù„ Ø£ÙŠ ÙˆØ¬Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ….</p>';
    }
  });
}

// --- Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ---
function saveProfile() {
  const age = parseInt(document.getElementById('ageInput').value);
  const weight = parseFloat(document.getElementById('weightInput').value);
  const height = parseInt(document.getElementById('heightInput').value);
  const goal = document.getElementById('goalInput').value;
  const calorieGoal = parseInt(document.getElementById('calorieGoalInput').value) || 2000;
  const stepGoal = parseInt(document.getElementById('stepGoalInput').value) || 10000;

  if (!age || !weight || !height) return alert('Ø£ÙƒÙ…Ù„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª');
  db.collection('users').doc(currentUser.uid).set({
    age, weight, height, goal, calorieGoal, stepGoal,
    username: currentUser.displayName,
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  }, { merge: true })
  .then(() => {
    dailyCalorieGoal = calorieGoal;
    dailyStepGoal = stepGoal;
    alert('ØªÙ… Ø§Ù„Ø­ÙØ¸');
    loadDashboard();
  });
}
function loadProfile() {
  db.collection('users').doc(currentUser.uid).get().then(doc => {
    if (doc.exists) {
      const data = doc.data();
      document.getElementById('ageInput').value = data.age || '';
      document.getElementById('weightInput').value = data.weight || '';
      document.getElementById('heightInput').value = data.height || '';
      document.getElementById('goalInput').value = data.goal || 'maintain';
      document.getElementById('calorieGoalInput').value = data.calorieGoal || 2000;
      document.getElementById('stepGoalInput').value = data.stepGoal || 10000;
      dailyCalorieGoal = data.calorieGoal || 2000;
      dailyStepGoal = data.stepGoal || 10000;
      document.getElementById('userInfo').innerText = `${translations[currentLang].appTitle} â€” ${data.username}`;
    }
  });
}

// --- Ø¯ÙˆØ§Ù„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ---
function renderActivityCalendar() {
  const container = document.getElementById('activityCalendar');
  container.innerHTML = '';
  const today = new Date();
  const days = currentLang === 'ar' ? ['Ø­', 'Ù†', 'Ø«', 'Ø±', 'Ø®', 'Ø¬', 'Ø³'] : ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
  days.forEach(day => {
    const dayEl = document.createElement('div');
    dayEl.className = 'calendar-day';
    dayEl.innerText = day;
    dayEl.style.fontWeight = 'bold';
    dayEl.style.color = 'var(--primary)';
    container.appendChild(dayEl);
  });
  for (let i = 0; i < 13; i++) {
    const date = new Date(today);
    date.setDate(today.getDate() - (13 - i));
    const dayEl = document.createElement('div');
    dayEl.className = 'calendar-day inactive';
    dayEl.innerText = date.getDate();
    container.appendChild(dayEl);
  }
  const todayEl = document.createElement('div');
  todayEl.className = 'calendar-day active';
  todayEl.innerText = today.getDate();
  container.appendChild(todayEl);
}

function updateCalorieProgress(consumed, goal) {
  const percent = Math.min(100, Math.round((consumed / goal) * 100));
  document.getElementById('calorieProgressBar').style.width = `${percent}%`;
  document.getElementById('calorieProgressText').innerText = `${consumed}/${goal}`;
  document.getElementById('calorieProgressPercent').innerText = `${percent}%`;
}

function updateStepProgress(steps, goal) {
  const percent = Math.min(100, Math.round((steps / goal) * 100));
  document.getElementById('stepProgressBar').style.width = `${percent}%`;
  document.getElementById('stepProgressText').innerText = `${steps}/${goal}`;
  document.getElementById('stepProgressPercent').innerText = `${percent}%`;
  
  if (steps >= goal && goal > 0) {
    document.getElementById('stepProgressBar').style.background = '#10b981';
    showNotification(translations[currentLang].notificationStepGoal);
  } else {
    document.getElementById('stepProgressBar').style.background = 'var(--primary)';
  }
}

function loadDashboard() {
  const today = new Date().toISOString().split('T')[0];
  Promise.all([
    db.collection('users').doc(currentUser.uid).collection('workouts').get(),
    db.collection('users').doc(currentUser.uid).collection('nutrition').get(),
    db.collection('users').doc(currentUser.uid).get()
  ]).then(([workoutsSnap, nutritionSnap, userDoc]) => {
    const userData = userDoc.data();
    dailyCalorieGoal = userData?.calorieGoal || 2000;
    dailyStepGoal = userData?.stepGoal || 10000;
    
    let burned = 0, consumed = 0, totalSteps = 0;
    workoutsSnap.forEach(doc => {
      const w = doc.data();
      if (w.date === today) {
        burned += w.calories || 0;
        totalSteps += w.steps || 0;
      }
    });
    nutritionSnap.forEach(doc => {
      const n = doc.data();
      if (n.date === today) consumed += n.calories || 0;
    });
    
    document.getElementById('caloriesBurned').innerText = burned;
    document.getElementById('caloriesConsumed').innerText = consumed;
    document.getElementById('netCalories').innerText = (burned - consumed);
    
    updateCalorieProgress(consumed, dailyCalorieGoal);
    updateStepProgress(totalSteps, dailyStepGoal);
    renderActivityCalendar();
  });
}

function startAutoSync() {
  if (syncInterval) clearInterval(syncInterval);
  syncInterval = setInterval(() => {
    if (document.getElementById('dashboardTab').classList.contains('hidden')) return;
    loadDashboard();
  }, 30000);
}

function exportData() { 
  alert('ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±'); 
}

// --- ØªÙ‡ÙŠØ¦Ø© ---
updateUI();
</script>
</body>
</html>
